<div class="form-container">
  <h1>{{ editMode() ? 'Edit Product' : 'Create Product' }}</h1>

  @if (error()) {
    <div class="error-message" role="alert">
      {{ error() }}
    </div>
  }

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="productId">Product ID</label>
      <input
        id="productId"
        type="text"
        formControlName="productId"
        [disabled]="editMode()"
        [class.error]="productForm.get('productId')?.invalid && productForm.get('productId')?.touched"
        required
      />
      @if (productForm.get('productId')?.invalid && productForm.get('productId')?.touched) {
        <span class="field-error">Product ID is required</span>
      }
    </div>

    <div class="form-group">
      <label for="productName">Product Name</label>
      <input
        id="productName"
        type="text"
        formControlName="productName"
        [class.error]="productForm.get('productName')?.invalid && productForm.get('productName')?.touched"
        required
      />
      @if (productForm.get('productName')?.invalid && productForm.get('productName')?.touched) {
        <span class="field-error">Product name is required</span>
      }
    </div>

    <div class="form-group">
      <label for="productDescription">Description</label>
      <textarea
        id="productDescription"
        formControlName="productDescription"
        rows="4"
        [class.error]="productForm.get('productDescription')?.invalid && productForm.get('productDescription')?.touched"
        required
      ></textarea>
      @if (productForm.get('productDescription')?.invalid && productForm.get('productDescription')?.touched) {
        <span class="field-error">Description is required</span>
      }
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="price">Price</label>
        <input
          id="price"
          type="number"
          step="0.01"
          formControlName="price"
          [class.error]="productForm.get('price')?.invalid && productForm.get('price')?.touched"
          required
        />
        @if (productForm.get('price')?.invalid && productForm.get('price')?.touched) {
          <span class="field-error">Valid price is required</span>
        }
      </div>

      <div class="form-group">
        <label for="stock">Stock</label>
        <input
          id="stock"
          type="number"
          formControlName="stock"
          [class.error]="productForm.get('stock')?.invalid && productForm.get('stock')?.touched"
          required
        />
        @if (productForm.get('stock')?.invalid && productForm.get('stock')?.touched) {
          <span class="field-error">Valid stock is required</span>
        }
      </div>
    </div>

    <div class="form-group">
      <label for="categoryId">Category</label>
      <select
        id="categoryId"
        formControlName="categoryId"
        [class.error]="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched"
        required
      >
        <option value="">Select a category</option>
        @for (category of categoriesList(); track category.id) {
          <option [value]="category.id">{{ category.name }}</option>
        }
      </select>
      @if (productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched) {
        <span class="field-error">Category is required</span>
      }
    </div>

    <div class="form-group">
      <label for="smallImageUrl">Small Image URL</label>
      <input
        id="smallImageUrl"
        type="url"
        formControlName="smallImageUrl"
        [class.error]="productForm.get('smallImageUrl')?.invalid && productForm.get('smallImageUrl')?.touched"
        required
      />
      @if (productForm.get('smallImageUrl')?.invalid && productForm.get('smallImageUrl')?.touched) {
        <span class="field-error">Small image URL is required</span>
      }
    </div>

    <div class="form-group">
      <label for="bigImageUrl">Big Image URL</label>
      <input
        id="bigImageUrl"
        type="url"
        formControlName="bigImageUrl"
        [class.error]="productForm.get('bigImageUrl')?.invalid && productForm.get('bigImageUrl')?.touched"
        required
      />
      @if (productForm.get('bigImageUrl')?.invalid && productForm.get('bigImageUrl')?.touched) {
        <span class="field-error">Big image URL is required</span>
      }
    </div>

    <div class="form-actions">
      <button
        type="submit"
        [disabled]="productForm.invalid || loading()"
        class="btn-submit"
      >
        @if (loading()) {
          <span>{{ editMode() ? 'Updating...' : 'Creating...' }}</span>
        } @else {
          <span>{{ editMode() ? 'Update Product' : 'Create Product' }}</span>
        }
      </button>
      <button
        type="button"
        (click)="router.navigate(['/admin/products'])"
        class="btn-cancel"
      >
        Cancel
      </button>
    </div>
  </form>
</div>

