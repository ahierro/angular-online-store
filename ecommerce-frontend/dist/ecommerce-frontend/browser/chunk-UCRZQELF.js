import{Qa as l,R as n,c as i,h as a}from"./chunk-OIPQTPKG.js";import{ac as r}from"./chunk-5MI47NIA.js";var d=(()=>{class s{constructor(t){this.http=t,this.tokenKey="auth_token",this.isAuthenticated=n(this.hasValidToken()),this.roles=n(this.getRolesFromToken()),this.username=n(this.getUsernameFromToken())}login(t){return this.http.post("/api/login",t).pipe(r(e=>{let o=typeof e=="string"?e:e?.token;if(!o)throw new Error("No token in response");this.setToken(o)}))}logout(){localStorage.removeItem(this.tokenKey),this.isAuthenticated.set(!1),this.roles.set([]),this.username.set(null)}getToken(){return localStorage.getItem(this.tokenKey)}isAdmin(){return this.roles().includes("ADMIN")}setToken(t){localStorage.setItem(this.tokenKey,t),this.isAuthenticated.set(this.hasValidToken()),this.roles.set(this.getRolesFromToken()),this.username.set(this.getUsernameFromToken())}hasValidToken(){let t=this.getToken();if(!t)return!1;try{let e=this.decode(t);return!e.exp||e.exp*1e3>Date.now()}catch{return!1}}getRolesFromToken(){let t=this.getToken();if(!t)return[];try{let e=this.decode(t),o=e.roles||e.authorities||[];return Array.isArray(o)?o:typeof o=="string"?o.split(","):[]}catch{return[]}}getUsernameFromToken(){let t=this.getToken();if(!t)return null;try{return this.decode(t).sub??null}catch{return null}}decode(t){let e=t.split(".");if(e.length!==3)throw new Error("Invalid token");return JSON.parse(atob(e[1]))}static{this.\u0275fac=function(e){return new(e||s)(a(l))}}static{this.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{d as a};
