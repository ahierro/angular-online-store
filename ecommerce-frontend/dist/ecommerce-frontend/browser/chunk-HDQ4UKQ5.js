import{a as L}from"./chunk-UCRZQELF.js";import{f as F}from"./chunk-FYAUQDTK.js";import{a as M}from"./chunk-3ZSPSCSW.js";import{$ as n,Ia as P,Ka as I,L as a,La as k,M as l,R as h,W as x,Y as m,_ as r,ca as v,fa as o,ga as u,ha as O,ia as b,k as f,na as C,oa as _,pa as S,qa as y}from"./chunk-OIPQTPKG.js";import"./chunk-5MI47NIA.js";var D=i=>["/orders",i];function T(i,E){if(i&1&&(r(0,"a",6)(1,"div"),o(2),n(),r(3,"div"),o(4),n(),r(5,"div"),o(6),S(7,"currency"),n(),r(8,"div",7),o(9),n()()),i&2){let e=E.$implicit;m("routerLink",_(8,D,e.id)),a(2),O("#",e.id,""),a(2),b("",e.username," (",e.email,")"),a(2),u(y(7,6,e.total)),a(3),u(e.status)}}var G=(()=>{class i{constructor(e,t){this.api=e,this.auth=t,this.orders=h([]),this.page=0,this.size=20}ngOnInit(){this.load()}load(){this.api.getPurchaseOrdersPaged({page:this.page,size:this.size}).subscribe(e=>this.orders.set(e.content))}createOrder(){let e=JSON.parse(localStorage.getItem("cart")||"{}"),t=Object.entries(e);if(t.length===0){alert("Cart is empty");return}import("./chunk-PH4T76QQ.js").then(({forkJoin:s})=>{s(t.map(([c,g])=>this.api.getProduct(c).pipe())).subscribe({next:c=>{let g=t.map(([d,p])=>({idProduct:d,quantity:p})),w=c.reduce((d,p,j)=>d+p.price*t[j][1],0),z=crypto.randomUUID();this.api.createPurchaseOrder({id:z,lines:g,total:w}).subscribe({next:()=>{localStorage.removeItem("cart"),this.load()},error:()=>alert("Failed to create order")})},error:()=>alert("Failed to compute total")})})}static{this.\u0275fac=function(t){return new(t||i)(l(M),l(L))}}static{this.\u0275cmp=f({type:i,selectors:[["app-order-list"]],standalone:!0,features:[C],decls:10,vars:1,consts:[[1,"orders"],[1,"toolbar"],["routerLink","/products"],[3,"click"],[1,"list"],["class","row",3,"routerLink",4,"ngFor","ngForOf"],[1,"row",3,"routerLink"],[1,"status"]],template:function(t,s){t&1&&(r(0,"div",0)(1,"h2"),o(2,"Purchase Orders"),n(),r(3,"div",1)(4,"button",2),o(5,"Shop more"),n(),r(6,"button",3),v("click",function(){return s.createOrder()}),o(7,"Create order from cart"),n()(),r(8,"div",4),x(9,T,10,10,"a",5),n()()),t&2&&(a(9),m("ngForOf",s.orders()))},dependencies:[k,P,I,F],styles:[".orders[_ngcontent-%COMP%]{padding:16px}.toolbar[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px}.list[_ngcontent-%COMP%]{display:grid;gap:8px}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 3fr 1fr 1fr;align-items:center;gap:8px;background:#fff;padding:10px;border-radius:6px;text-decoration:none;color:inherit}.status[_ngcontent-%COMP%]{text-transform:capitalize}button[_ngcontent-%COMP%]{padding:8px 10px}"]})}}return i})();export{G as OrderListComponent};
